#!/bin/bash

# rsyncs the contents of all Docker volume to the backup staging area, and then 
# backs up the staged files to a restic repository


# Ensure the script exits if any command fails
set -e

# Fetch the list of volume names
VOLUMES=$(docker volume ls -q)

for VOLUME in $VOLUMES; do
  echo "Staging backup for volume '$VOLUME'."
  /usr/local/bin/stage-volume-backup "$VOLUME"
  echo "Copied volume '$VOLUME' to backup staging directory '$BACKUP_DIR'."
done

echo "All volume back ups staged successfully!"
